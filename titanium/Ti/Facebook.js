define(["Ti/_/Evented","Ti/_/lang"],function(e,t){function n(){FB.init({appId:l,status:!1,cookie:!0,oauth:!0,xfbml:!0}),FB.getLoginStatus(function(e){s=!0,"connected"==e.status&&i(e)||u&&o()},!0)}function i(e){var t=e.authResponse;return t?(a.loggedIn=!0,a.uid=t.userID,a.expirationDate=new Date(Date.now()+1e3*t.expiresIn),a.accessToken=t.accessToken,t.expiresIn&&setTimeout(function(){a.logout()},1e3*t.expiresIn),a.fireEvent("login",{cancelled:!1,data:e,success:!0,uid:a.uid}),!0):void 0}function r(e,t,n,i){result={source:a,success:!1},result[t]=n,!e||e.error?e&&(result.error=e.error):(result.success=!0,result.result=JSON.stringify(e)),i(result)}function o(){FB.login(function(e){i(e)||a.fireEvent("login",{cancelled:!0,data:e,error:"user cancelled or an internal error occured.",success:!1,uid:e.id})},{scope:a.permissions.join()})}var a,s=!1,u=!1,l=null,c="not logged in",d=document.createElement("div"),h="facebook-jssdk",f=!1;if(a=t.setObject("Ti.Facebook",e,{authorize:function(){if(!l)throw Error("App ID not set. Facebook authorization cancelled.");s?o():u=!0},createLoginButton:function(e){return new(require("Ti/Facebook/LoginButton"))(e)},dialog:function(e,t,n){a.loggedIn?(t.method=e,FB.ui(t,function(t){r(t,"action",e,n)})):n({success:!1,error:c,action:e,source:a})},logout:function(){a.loggedIn&&FB.logout(function(){a.loggedIn=!1,a.fireEvent("logout",{success:!0})})},request:function(e,t,n){a.loggedIn?(t.method=e,t.urls="facebook.com,developers.facebook.com",FB.api(t,function(t){r(t,"method",e,n)})):n({success:!1,error:c,method:e,source:a})},requestWithGraphPath:function(e,t,n,i){a.loggedIn?FB.api(e,n,t,function(t){r(t,"path",e,i)}):i({success:!1,error:c,path:e,source:a})},constants:{BUTTON_STYLE_NORMAL:1,BUTTON_STYLE_WIDE:2},properties:{accessToken:void 0,appid:{set:function(e){return l=e,f&&n(),e}},expirationDate:void 0,forceDialogAuth:!0,loggedIn:!1,permissions:void 0,uid:void 0}}),d.id="fb-root",document.body.appendChild(d),!document.getElementById(h)){var p=document.createElement("script"),g=document.getElementsByTagName("head")[0];p.id=h,p.async=!0,p.src="//connect.facebook.net/en_US/all.js",g.insertBefore(p,g.firstChild)}return window.fbAsyncInit=function(){f=!0,l&&n()},a});