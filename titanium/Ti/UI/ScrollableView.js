define(["Ti/_/declare","Ti/UI/View","Ti/_/dom","Ti/_/has","Ti/_/style","Ti/UI","Ti/_/browser"],function(t,e,i,n,r,o,a){var s=r.set,u=require.is,l=i.unitize,c=require.on,d=c.once,h=window,f={webkit:"webkitTransitionEnd",trident:"msTransitionEnd",gecko:"transitionend",presto:"oTransitionEnd"},_=f[a.runtime]||"transitionEnd",p=n("touch"),g=200,m=10,v=25,T=1e3,E=.5,y=2;return t("Ti.UI.ScrollableView",e,{constructor:function(){var t,e=this,i=0;e._add(e._contentContainer=o.createView({left:0,top:0,width:o.SIZE,height:"100%",layout:"constrainingHorizontal"})),t=e._contentContainer.domNode,e._add(e._pagingControlContainer=o.createView({width:"100%",height:20,bottom:0,backgroundColor:"black",opacity:0,touchEnabled:!1})),e._pagingControlContainer._add(e._pagingControlContentContainer=o.createView({width:o.SIZE,height:"100%",top:0,touchEnabled:!1,layout:"constrainingHorizontal"})),e.properties.__values__.views=[],e._viewToRemoveAfterScroll=-1,c(e,"postlayout",function(){e._animating||e._setTranslation(e.currentPage*-e._measuredWidth)}),c(t,p?"touchstart":"mousedown",function(n){var r=n.touches?n.touches[0].clientX:n.clientX,o=r,a=Date.now(),u=e._measuredWidth,l=function(t){var n=e.currentPage,a=o-r+i;u=e._measuredWidth,t.preventDefault(),o=t.touches?t.touches[0].clientX:t.clientX,e._setTranslation(n*-u+a),e.fireEvent("scroll",{currentPage:n,currentPageAsFloat:n-a/u,view:e.views[n]})},c=function(n){var f=Date.now(),I=g>f-a,b=e.currentPage,w=Math.abs(r-o)>(I?m:u/2),A=e.properties.__values__,S=Math.abs(o-r);h.removeEventListener(p?"touchmove":"mousemove",l),h.removeEventListener(p?"touchend":"mouseup",c),u=e._measuredWidth,e._animating=1,n.preventDefault(),w&&(r>o?b!==A.views.length-1&&b++:0!==b&&b--,S=u-S),e._showPagingControl(b),i=o-r+i,S=Math.max(v,Math.min(T,(I?E:y)*S)),s(t,"transition",S+"ms ease-out"),setTimeout(function(){d(t,_,function(){s(t,"transition",""),e._animating=0,A.currentPage=b,e._updatePagingControl(),e.fireEvent("scrollend",{currentPage:b,view:e.views[b]})}),e._setTranslation(b*-u)},1),e.fireEvent("dragend",{currentPage:b,view:e.views[b]})};e._showPagingControl(e.currentPage,1),n.preventDefault(),i=e._animating?i||0:0,s(t,"transition",""),e._setTranslation(e.currentPage*-u+i),e._animating=0,h.addEventListener(p?"touchmove":"mousemove",l),h.addEventListener(p?"touchend":"mouseup",c),e.fireEvent("dragstart")})},_setTranslation:function(t){s(this._contentContainer.domNode,"transform","translatez(0) translatex("+t+"px)")},_showPagingControl:function(t,e){var i=this;return i.showPagingControl?(i._pagingAnimation&&i._pagingAnimation.cancel(),i._pagingAnimation=i._pagingControlContainer.animate({duration:250,opacity:.75}),clearInterval(i._pagingTimeout),!e&&i.pagingControlTimeout>0?i._pagingTimeout=setTimeout(function(){i._pagingAnimation&&i._pagingAnimation.cancel(),i._pagingAnimation=i._pagingControlContainer.animate({duration:750,opacity:0},function(){i._pagingAnimation=void 0})},i.pagingControlTimeout):i._pagingAnimation=void 0,void 0):(i._pagingControlContainer.opacity=0,void 0)},_updatePagingControl:function(){var t=this._pagingControlContentContainer,e=this.views.length,i=this.pagingControlHeight/2;if(e!==t._numViews||i!==t._diameter){t._numViews=e,t._diameter=i,t._removeAllChildren();for(var n=0;this.views.length>n;n++)t._add(o.createView({width:i,height:i,left:5,right:5,backgroundColor:"#aaa",borderRadius:l(i/2)}));t._highlightedPage=-1}t._highlightedPage!==this.currentPage&&(0>t._highlightedPage||(t._children[t._highlightedPage].backgroundColor="#aaa"),t._children[this.currentPage].backgroundColor="#fff",t._highlightedPage=this.currentPage)},addView:function(t){t&&(t.width="100%",t.height="100%",this.views.push(t),this._contentContainer._add(t),1==this.views.length&&(this.properties.__values__.currentPage=0),this._updatePagingControl())},removeView:function(t){var e=u(t,"Number")?t:this.views.indexOf(t);0>e||e>=this.views.length||(e==this.currentPage&&1!==this.views.length?(this._viewToRemoveAfterScroll=e,this.scrollToView(e==this.views.length-1?--e:++e)):this._removeViewFromList(e))},_removeViewFromList:function(t){var e=this._contentContainer,i=this;this.currentPage>t&&i.properties.__values__.currentPage--,e._remove(i.views.splice(t,1)[0]),i.views.length||(i.properties.__values__.currentPage=-1),d(o,"postlayout",function(){setTimeout(function(){i._setTranslation(i.currentPage*-i._measuredWidth)},1)})},scrollToView:function(t,e){function i(){var t=r._contentContainer,i=t.domNode,o=-r.views[n]._measuredLeft,a=Math.max(v,Math.min(T,y*t._measuredWidth));r._updatePagingControl(),r._showPagingControl(n),e?(r._setTranslation(o),r.properties.__values__.currentPage=n):(s(i,"transition",a+"ms ease-out"),setTimeout(function(){d(i,_,function(){s(i,"transition",""),r._animating=0,r.properties.__values__.currentPage=n,r._updatePagingControl(),-1!==r._viewToRemoveAfterScroll&&(o+=r.views[r._viewToRemoveAfterScroll]._measuredWidth,r._removeViewFromList(r._viewToRemoveAfterScroll),r._viewToRemoveAfterScroll=-1),r.fireEvent("scrollend",{currentPage:n,view:r.views[n]})}),r._setTranslation(o)},1))}var n=u(t,"Number")?t:this.views.indexOf(t),r=this;0>n||n>=this.views.length||n==this.currentPage||(r._contentContainer.domNode.offsetWidth?i():d(r,"postlayout",i))},_defaultWidth:o.FILL,_defaultHeight:o.FILL,properties:{currentPage:{set:function(t,e){return t>=0&&this.views.length>t?(this.scrollToView(t,1),t):e},value:-1},pagingControlColor:{set:function(t){return this._pagingControlContainer.backgroundColor=t,t},value:"black"},pagingControlHeight:{set:function(t){return this._pagingControlContainer.height=t,t},value:20},pagingControlTimeout:{post:function(t){t||(this._pagingControlContainer.opacity=.75)},value:3e3},showPagingControl:!1,views:{set:function(t){if(u(t,"Array")){var e,i=0,n=t.length,r=this._contentContainer;for(r._removeAllChildren();n>i;i++)(e=t[i]).width="100%",e.height="100%",r._add(e);return this.properties.__values__.currentPage=n?0:-1,t}},post:"_updatePagingControl"}}})});