define(["Ti/_/Layouts/Base","Ti/_/declare","Ti/UI","Ti/_/lang"],function(t,e,i,n){var r=n.isDef,o=Math.round;return e("Ti._.Layouts.Vertical",t,{_doLayout:function(t,e,n,r,a){var s,u,l,c,h,d,_,f,p,g,m,T,v,b,E,I={width:0,height:0},y=t._children,x=0,w="px",N=[],S=0,C=y.length,A=this._measureNode;for(x=0;C>x;x++)s=t._children[x],s._alive&&s.domNode?(s._measuredRunningHeight=S,s._markedForLayout&&((s._preLayout&&s._preLayout(e,n,r,a)||s._needsMeasuring)&&A(s,s,s._layoutCoefficients,this),u=s._layoutCoefficients,l=u.width,c=u.height,h=u.sandboxWidth,d=u.sandboxHeight,f=u.left,_=u.top,g=l.x1*e+l.x2,m=c.x1*n+c.x2*(n-S)+c.x3,p=s._getContentSize?s._getContentSize(g,m):s._layout._doLayout(s,isNaN(g)?e:g-s._borderLeftWidth-s._borderRightWidth,isNaN(m)?n:m-s._borderTopWidth-s._borderBottomWidth,isNaN(g),isNaN(m)),isNaN(g)&&(g=p.width+s._borderLeftWidth+s._borderRightWidth),isNaN(m)&&(m=p.height+s._borderTopWidth+s._borderBottomWidth),s._measuredWidth=g,s._measuredHeight=m,r&&0!==f.x1?N.push(s):(b=s._measuredLeft=f.x1*e+f.x2*g+f.x3,v=s._measuredSandboxWidth=h.x1*e+h.x2+g+(isNaN(b)?0:b)),s._measuredTop=_.x1*n+_.x2+S,T=s._measuredSandboxHeight=d.x1*n+d.x2+m),s._measuredSandboxWidth>I.width&&(I.width=s._measuredSandboxWidth),S=I.height+=s._measuredSandboxHeight):this.handleInvalidState(s,t);for(C=N.length,x=0;C>x;x++)s=N[x],h=s._layoutCoefficients.sandboxWidth,v=s._measuredSandboxWidth=h.x1*e+h.x2+s._measuredWidth,v>I.width&&(I.width=v);for(x=0;C>x;x++)s=N[x],f=s._layoutCoefficients.left,h=s._layoutCoefficients.sandboxWidth,g=s._measuredWidth,v=s._measuredSandboxWidth,v>I.width&&(I.width=v),b=s._measuredLeft=f.x1*I.width+f.x2*g+f.x3,s._measuredSandboxWidth+=isNaN(b)?0:b;for(C=y.length,x=0;C>x;x++)s=y[x],s._markedForLayout&&(i._elementLayoutCount++,s=y[x],E=s.domNode.style,E.zIndex=s.zIndex,E.left=o(s._measuredLeft)+w,E.top=o(s._measuredTop)+w,E.width=o(s._measuredWidth-s._borderLeftWidth-s._borderRightWidth)+w,E.height=o(s._measuredHeight-s._borderTopWidth-s._borderBottomWidth)+w,s._markedForLayout=!1,s.fireEvent("postlayout"));return this._computedSize=I},_getWidth:function(t,e){return!r(e)&&2>r(t.left)+r(t.center&&t.center.x)+r(t.right)&&(e=t._defaultWidth),e===i.INHERIT?t._parent._parent?t._parent._parent._layout._getWidth(t._parent,t._parent.width)===i.SIZE?i.SIZE:i.FILL:i.FILL:e},_getHeight:function(t,e){return!r(e)&&(e=t._defaultHeight),e===i.INHERIT?t._parent._parent?t._parent._parent._layout._getHeight(t._parent,t._parent.height)===i.SIZE?i.SIZE:i.FILL:i.FILL:e},_isDependentOnParent:function(t){var e=t._layoutCoefficients;return!isNaN(e.width.x1)&&0!==e.width.x1||!isNaN(e.height.x1)&&0!==e.height.x1||!isNaN(e.height.x2)&&0!==e.height.x2||0!==e.sandboxWidth.x1||0!==e.sandboxHeight.x1||0!==e.left.x1||0!==e.top.x1},_doAnimationLayout:function(t,e){var i=t._parent._measuredWidth,n=t._parent._measuredHeight,r=t._measuredRunningHeight,o=e.width.x1*i+e.width.x2;return{width:o,height:e.height.x1*n+e.height.x2*(n-r)+e.height.x3,left:e.left.x1*i+e.left.x2*o+e.left.x3,top:e.top.x1*n+e.top.x2+r}},_measureNode:function(t,e,n,r){t._needsMeasuring=!1;var o,a,s,u=r.getValueType,l=r.computeValue,c=r._getWidth(t,e.width),h=u(c),d=l(c,h),_=r._getHeight(t,e.height),f=u(_),p=l(_,f),g=e.left,m=u(g),T=l(g,m),v=e.center&&e.center.x,b=u(v),E=l(v,b),I=e.right,y=u(I),x=l(I,y),w=e.top,N=u(w),S=l(w,N),C=e.bottom,A=u(C),L=l(C,A),O=n.width,R=n.height,D=n.sandboxWidth,P=n.sandboxHeight,k=n.left,U=n.top;if(o=a=0,h===i.SIZE?o=a=0/0:h===i.FILL?(o=1,"%"===m?o-=T:"#"===m?a=-T:"%"===y?o-=x:"#"===y&&(a=-x)):"%"===h?o=d:"#"===h?a=d:"%"===m?"%"===b?o=2*(E-T):"#"===b?(o=-2*T,a=2*E):"%"===y?o=1-T-x:"#"===y&&(o=1-T,a=-x):"#"===m?"%"===b?(o=2*E,a=-2*T):"#"===b?a=2*(E-T):"%"===y?(o=1-x,a=-T):"#"===y&&(o=1,a=-x-T):"%"===b?"%"===y?o=2*(x-E):"#"===y&&(o=-2*E,a=2*x):"#"===b&&("%"===y?(o=2*x,a=-2*E):"#"===y&&(a=2*(x-E))),O.x1=o,O.x2=a,D.x1="%"===y?x:0,D.x2="#"===y?x:0,o=a=s=0,f===i.SIZE?o=a=s=0/0:f===i.FILL?(a=1,"%"===N&&(o=-S),"#"===N&&(s=-S),"%"===A&&(o=-L),"#"===A&&(s=-L)):"%"===f?o=p:"#"===f&&(s=p),R.x1=o,R.x2=a,R.x3=s,o=a=0,"%"===N&&(o=S),"#"===N&&(a=S),"%"===A&&(o+=L),"#"===A&&(a+=L),P.x1=o,P.x2=a,o=a=s=0,"%"===m)o=T;else if("#"===m)s=T;else if("%"===b)o=E,a=-.5;else if("#"===b)a=-.5,s=E;else if("%"===y)o=1-x,a=-1;else if("#"===y)o=1,a=-1,s=-x;else switch(r._defaultHorizontalAlignment){case"center":o=.5,a=-.5;break;case"end":o=1,a=-1}k.x1=o,k.x2=a,k.x3=s,U.x1="%"===N?S:0,U.x2="#"===N?S:0},_defaultHorizontalAlignment:"center",_defaultVerticalAlignment:"start"})});